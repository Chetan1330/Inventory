{% extends "layouts/base.html" %} {% load static %} {% load widget_tweaks %} 
{% block title %} Create Purchase {% endblock title %} 
{% block content %}
<div class="card">
  <div class="card-header">
    <div class="row">
      <div class="col-sm-3">
        <h5>ID: <span>C515LM1W</span></h5>
      </div>
      <div class="col-sm-3">
        <h5>Date: <span>August'30 2023</span></h5>
      </div>
      <div class="col-sm-3">
        <h5>Account: <span>Mercury</span></h5>
      </div>
      <div class="col-sm-3">
        <h5>Requested By: <span>James Cameron</span></h5>
      </div>
    </div>
  </div>
  <div class="card-body" id="form-container">
    <div class="row">
      <div class="col-sm-6">
        <div class="dropdown purchase">
          <button
            class="dropdown-toggle purchase"
            type="button"
            data-toggle="dropdown"
          >
            Items
            <span class="purchase caret"></span>
          </button>
          <ul class="dropdown-menu purchase">
            <li>
                <form class="item-form">
                  <div class="form-row">
                    <div class="form-group col-md-6">
                      <label for="name">Name:</label>
                      <select class="form-control" id="name">
                        <option value="Net-Adapter">Net Adapter</option>
                        <option value="Memory-chip">Memory chip</option>
                        <option value="Integrator">Integrator</option>
                      </select>
                    </div>
                    <div class="form-group col-md-6">
                      <label for="type">Type:</label>
                      <select class="form-control" id="type">
                        <option value="Semi-conductor">Semi conductor</option>
                        <option value="Resistor">Resistor</option>
                        <option value="Volter">Volter</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group col-md-6">
                      <label for="quantity">Quantity:</label>
                      <input type="number" class="form-control" id="quantity" />
                    </div>
                    <div class="form-group col-md-6">
                      <label for="link">Link:</label>
                      <input type="text" class="form-control" id="link" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="description">Description:</label>
                    <input type="text" class="form-control" id="description" />
                  </div>
                  <div class="form-group col-md-12" style="display: flex;">
                    <button type="button" class="global-btn" style="margin: 10px;" onclick="populateTable(this.form); return false;" >Submit</button>
                    <button type="button" class="global-btn add-new-btn" style="margin: 10px;" onclick="addNewFields(event); return false;">
                      Add New+
                    </button>
                  </div> 
                </form> 
                
            </li>
          </ul>
        </div>
      </div>
    </div>
    <br />
    <div class="table-responsive">
      <table
        id="vendortable"
        class="table tablemanager customers-list table-bordered"
      >
        <thead>
          <tr>
            <th>NAME</th>
            <th>TYPE</th>
            <th>QUANTITY</th>
            <th>LINK</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border">
            <td>Peter</td>
            <td>Net Adapter</td>
            <td>5</td>
            <td><a href="#">www.ust.com</a></td>
            <td>This is in need for outsourcing</td>
          </tr>
          <tr class="border">
            <td>Paul</td>
            <td>Net Adapter</td>
            <td>5</td>
            <td><a href="#">www.ust.com</a></td>
            <td>This is in need for outsourcing</td>
          </tr>
          <tr class="border">
            <td>Jack</td>
            <td>Net Adapter</td>
            <td>5</td>
            <td><a href="#">www.ust.com</a></td>
            <td>This is in need for outsourcing</td>
          </tr>
          <tr class="border">
            <td>Julius</td>
            <td>Net Adapter</td>
            <td>5</td>
            <td><a href="#">www.ust.com</a></td>
            <td>This is in need for outsourcing</td>
          </tr>
          <tr class="border">
            <td>Ceaser</td>
            <td>Net Adapter</td>
            <td>5</td>
            <td><a href="#">www.ust.com</a></td>
            <td>This is in need for outsourcing</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label for="approverDetails">Approver Details:</label>
        <ul style="list-style-type: none">
          <li>Name: Aston Martin</li>
          <li>Role: Manager</li>
          <li>Location: New York,USA</li>
        </ul>
      </div>
      <div class="col-sm-6" style="display: flex;">
        <button type="button" class="global-btn" style="height: 54px; margin: 10px;">Submit</button>
        <button type="button" class="global-btn" style="height: 54px; margin: 10px;">+Save Template</button>
      </div>
    </div>
  </div>
</div>

  
<script>
  (function (document) {
  "use strict";

  // Counter to generate unique IDs for cloned forms
  var formCounter = 0;

  // Array to store form data
  var formDataArray = [];

  function populateTable(form) {
    console.log(form,'form')
    // Get the values from the form fields
    var formCounter = form.id.split("-")[1];
    var itemName = form.querySelector("#name-" + formCounter).value;
    var itemType = form.querySelector("#type-" + formCounter).value;
    var itemQuantity = form.querySelector("#quantity-" + formCounter).value;
    var itemLink = form.querySelector("#link-" + formCounter).value;
    var itemDescription = form.querySelector("#description-" + formCounter).value;
    console.log(formCounter,'formcounter')
    // Create a new object with the entered values
    var formData = {
      name: itemName,
      type: itemType,
      quantity: itemQuantity,
      link: itemLink,
      description: itemDescription,
    };
    console.log(formData,'fd')
    // Push form data to the array
    formDataArray.push(formData);
    console.log(formDataArray,'fdarr')
    // Update the table with all form data
    updateTable();

    // Clear the form fields
    form.reset();
  }


  function updateTable() {
    // Get the table body
    var tableBody = document.querySelector("#vendortable tbody");
    console.log(tableBody,'table')
    // Loop through the formDataArray and append the data to the table
    formDataArray.forEach(function (formData) {
      var newRow = tableBody.insertRow(tableBody.rows.length);
      var cells = [
        newRow.insertCell(0),
        newRow.insertCell(1),
        newRow.insertCell(2),
        newRow.insertCell(3),
        newRow.insertCell(4),
      ];

      // Populate the cells with the form data
      cells[0].textContent = formData.name;
      cells[1].textContent = formData.type;
      cells[2].textContent = formData.quantity;
      cells[3].innerHTML =
        '<a href="' + formData.link + '">' + formData.link + "</a>";
      cells[4].textContent = formData.description;
    });
    console.log(newRow,'newRow')
  }

  function addNewFields(event) {
    event.preventDefault();

    // Increment the formCounter to generate unique IDs
    formCounter++;
    console.log(event,'event')
    // Clone the form and clear the input fields in the cloned form
    var formToClone = event.target.closest(".item-form");
    var clonedForm = formToClone.cloneNode(true);
    clonedForm.querySelectorAll("input, select").forEach(function (element) {
      // Generate unique IDs for input and select fields
      element.id = element.id + "-" + formCounter;
      if (element.tagName === "INPUT") {
        element.value = ""; // Clear input field values
      }
    });
    console.log(formToClone,formCounter)
    // Remove the "Submit" and "Add New+" buttons from the old form
    var submitBtn = formToClone.querySelector('.global-btn[type="button"]');
    var addNewBtn = formToClone.querySelector(".add-new-btn");

    if (submitBtn) {
      submitBtn.remove();
    }
    if (addNewBtn) {
      addNewBtn.remove();
    }
    
    // Append the cloned form inside the <li> element
    var formContainer = document.querySelector(".form-container");
    formContainer.insertAdjacentHTML("beforeend", clonedForm.outerHTML);
    console.log(formContainer,clonedForm.outerHTML)
  }
})(document);;

</script>
  
{% endblock content %}
